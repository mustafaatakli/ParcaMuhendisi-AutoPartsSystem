<!DOCTYPE html>
<html>
<head>
    <title>Test Login</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <h1>Test Admin Login & Categories</h1>
    <button onclick="testLogin()">1. Test Login</button>
    <button onclick="testCategories()">2. Test Categories</button>
    <button onclick="testAdminStats()">3. Test Admin Stats</button>
    <div id="result" style="margin-top: 20px; white-space: pre-wrap; background: #f0f0f0; padding: 10px;"></div>

    <script>
        let token = null;

        async function testLogin() {
            try {
                const response = await axios.post('http://localhost:5167/api/Auth/login', {
                    email: 'admin@parcamuhendisi.com',
                    password: 'Admin123!'
                });

                token = response.data.token;
                localStorage.setItem('token', token);
                axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;

                document.getElementById('result').textContent =
                    'Login successful!\n' +
                    'User: ' + response.data.user.fullName + '\n' +
                    'Role: ' + response.data.user.role + '\n' +
                    'Token: ' + token.substring(0, 50) + '...';
            } catch (error) {
                document.getElementById('result').textContent =
                    'Login failed!\n' + error.message;
            }
        }

        async function testCategories() {
            try {
                const response = await axios.get('http://localhost:5167/api/Categories');
                document.getElementById('result').textContent =
                    'Categories loaded successfully!\n' +
                    'Count: ' + response.data.length + '\n' +
                    'Categories: ' + JSON.stringify(response.data, null, 2);
            } catch (error) {
                document.getElementById('result').textContent =
                    'Categories failed!\n' + error.message;
            }
        }

        async function testAdminStats() {
            if (!token) {
                document.getElementById('result').textContent =
                    'Please login first!';
                return;
            }

            try {
                const response = await axios.get('http://localhost:5167/api/admin/stats', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                document.getElementById('result').textContent =
                    'Admin stats loaded successfully!\n' +
                    JSON.stringify(response.data, null, 2);
            } catch (error) {
                document.getElementById('result').textContent =
                    'Admin stats failed!\n' +
                    'Status: ' + error.response?.status + '\n' +
                    'Message: ' + error.message;
            }
        }

        // Check if token exists in localStorage
        window.onload = function() {
            const savedToken = localStorage.getItem('token');
            if (savedToken) {
                token = savedToken;
                axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;
                document.getElementById('result').textContent =
                    'Token found in localStorage!\n' +
                    'Token: ' + token.substring(0, 50) + '...';
            }
        };
    </script>
</body>
</html>
